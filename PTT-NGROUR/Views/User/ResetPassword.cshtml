@{
    ViewBag.Title = "ResetPassword";
    Layout = null;
}

<h2>Reset Password</h2>
@if (!ViewBag.IsExpired)
{
    <p>Change Password</p>
}
else { 
    <p>Reset Password</p>
}
<form>
    @Html.Password("OldPassword", null, new { @class = "form-control", @placeholder = "Old Password" })
    @Html.Password("NewPassword", null, new { @class = "form-control", @placeholder = "New Password" })
    @Html.Password("ConfirmNewPassword", null, new { @class = "form-control", @placeholder = "Confirm New Password" })
    <input onclick="ChangePassword()" class="btn btn-lg btn-info btn-block" value="Confirm" type="button">
</form>
<script src="~/Scripts/jquery-1.11.1.min.js"></script>
<script type="text/javascript">

            var apppath = '@Url.Content("~/")';
            var serverpath = apppath.substring(0, apppath.length - 1);
            var txtOldPassword = $("#OldPassword").val();
            var txtNewPassword = $("#NewPassword").val();
            var txtConfirmNewPassword = $("#ConfirmNewPassword").val();
            

            function ChangePassword() {

                var txtOldPassword = $("#OldPassword").val();
                var txtNewPassword = $("#NewPassword").val();
                var txtConfirmNewPassword = $("#ConfirmNewPassword").val();
                var url = "";
                var serverpath = apppath.substring(0, apppath.length - 1);

                if (txtNewPassword == "") {
                    alert("โปรดใส่ password");
                }
                    //else {
                    //    if (!/^\w+$/.test(txtNewPassWord)) {
                    //        alert("password ไม่ถูกต้อง password ต้องไม่มีอักขระพิเศษ");
                    //    }
                else {
                    if (txtNewPassword.length < 8) {
                        alert("password น้อยกว่า8ตัว โปรดใส่ password ใหม่");
                    }
                    else {
                        if (!/[A-Z]/.test(txtNewPassword)) {
                            alert("password ไม่ถูกต้อง ต้องมีอักษรพิมพ์ใหญ่อย่างน้อย1อักษร");

                        }
                        else {
                            if (!/[a-z]/.test(txtNewPassword)) {
                                alert("password ไม่ถูกต้อง ต้องมีอักษรพิมพ์เล็กอย่างน้อย1อักษร");
                            }

                            else {

                                if (!/[0-9]/.test(txtNewPassword)) {
                                    alert("password ไม่ถูกต้อง ต้องมีตัวเลขอย่างน้อย1ตัว");

                                }
                                else {

                                    //  window.location.href = serverpath + /user/login;

                                    $.ajax({
                                        async: true,
                                        cache: false,
                                        url: serverpath + '/User/ChangePassword',
                                        type: 'POST',
                                        data: { OldPassWord: txtOldPassword, NewPassword: txtNewPassword, ConfirmNewPassword: txtConfirmNewPassword },
                                        success: function (response) {
                                            alert(response);
                                            if (response == "Password changed successfully") {
                                                window.location.href = serverpath + '/User/Login';

                                            }
                                        }
                                    });

                                }
                            }
                        }
                    }
                }
                // }

            };
</script>