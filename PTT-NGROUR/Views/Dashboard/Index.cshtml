@model PTT_NGROUR.Models.ViewModel.ModelUtilization
@{
    ViewBag.Title = "Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js" type="text/javascript"></script>
<script src="~/Scripts/Chart/Chart.PieceLabel.min.js"></script>
<link href="~/Scripts/bootstrap-select-1.12.4/dist/css/bootstrap-select.min.css" rel="stylesheet" />

<br />
<div class="ph2 ph0-xs">
    <div class=" p-3 mb-2 col-container col-container-white text-dark ">
        <div class=" " style="padding-bottom:.5rem;padding-top:1rem">

            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <span class=" col-md-1"></span>
                    <span class="col-lg-2 col-md-2 col-sm-2 col-xs-10">
                        <label class=" ml-5 lato" style="padding-right:6px">
                            <input type="radio" name="radio" id="radioRegion" checked="checked" onclick="javascript:Check();">
                            <span class="checkmark h6 b">Region</span>
                        </label>&nbsp;
                        <label class="d-none ">
                            <input type="radio" name="radio" id="radioLicense" onclick="javascript:Check();">
                            <span class="checkmark h6 b"> License</span>
                        </label>
                    </span>
                    <div class="col-lg-4 col-md-5  col-sm-5 col-xs-7" id="seRegion" style="padding-bottom: 0rem !important">
                        <div class="form-group" style="margin-bottom:5px;">

                            <select class="selectpicker fz-12px form-control" name="MultiRegion" id="MultiRegion" multiple data-selected-text-format="count" data-live-search="true" data-actions-box="true" style="margin-bottom:-1rem;">
                                @foreach (PTT_NGROUR.Models.DataModel.ModelRegion ml in Model.ListRegion)
                                {
                                    <option value="@ml.REGION_ID" class="text-grey" style="word-wrap:break-word;font-size:15px">@ml.REGION_NAME</option>
                                }
                            </select>
                        </div>
                    </div>
                   

                    <div class="col-lg-4 col-md-5 col-sm-5 col-xs-7" id="seLicense" style="padding-bottom: 0rem !important">
                        <div class="form-group" style="margin-bottom:5px;">
                            <select class="selectpicker fz-12px form-control" name="MultiLicense" id="MultiLicense" multiple data-selected-text-format="count" data-live-search="true" data-actions-box="true" style="">
                                @foreach (PTT_NGROUR.Models.DataModel.ModelLicenseMaster ml in Model.ListLicense)
                                {
                                    <option class="hidden-sm hidden-xs" value="@ml.LICENSE_ID" style="word-wrap: break-word">@ml.LICENSE</option>
                                    <option class="hidden-lg hidden-md" value="@ml.LICENSE_ID" style="word-wrap: break-word;white-space:normal">@ml.LICENSE</option>
                                }
                            </select>
                        </div>
                    </div>
                    <span class="col-xs-3 hidden-lg hidden-sm hidden-md"></span>
                    <div class="col-lg-2 col-md-2 col-sm-2 col-xs-5" id="seLicense" style="padding-bottom: 0rem !important">
                        <div class="form-group" style="margin-bottom:5px;">
                            <select class="selectpicker fz-12px form-control">
                                <option value="pipeline">Pipeline</option>
                                <option value="mustard">Gate Station</option>
                            </select>
                        </div>
                    </div>
                    <span class="col-lg-1 col-sm-2 col-xs-1">
                        <button type="button" class="btn btn-primary" id="btnSearch" onclick="Search()" style="border-radius:0">
                            <span class="glyphicon glyphicon-search"></span> Search
                        </button>
                    </span>
                    <span class="col-lg-3 col-md-3 col-sm-3 col-xs-1"></span>
                </div>
            </div>

           
                </div>
        </div>
    </div>


    <br />

    <div class="ph2 ph0-xs">
        <div class=" " style="padding-bottom:.5rem;padding-top:1rem">
            <div class="row">
                <div class="col-lg-12">

                </div>
            </div>
            <div class="row">
                
                    <div class="col-lg-6 col-md-6">
                        <div class=" p-3 mb-2 col-container col-container-white text-dark ">
                            
                            <div style="font-family: Corbel; font-size: small ;text-align:center " class="row">
                                <center>
                                    <div class="pt5" >Gate Station</div>
                                    <div class="pieGraph-lg pieGraph-md pieGraph-sm pieGraph-xs" style="margin-top:-2rem;">
                                        <canvas id="pieGate" style="padding: 0;margin: auto;display: block; "> </canvas>
                                    </div>
                                </center>
                           </div>  

                        </div>
                    </div>

                <div class="col-lg-6 col-md-6">
                    <div class=" p-3 mb-2 col-container col-container-white text-dark ">
                       
                            <div style="font-family: Corbel; font-size: small ;text-align:center " class="row">
                                <center>
                                    <div class="pt5 ">Pipeline</div>
                                    <div class="pieGraph-lg pieGraph-md pieGraph-sm pieGraph-xs" style="margin-top:-2rem;">
                                        <canvas id="piePipeline" style="padding: 0;margin: auto;display: block; "> </canvas>
                                    </div>
                                </center>
                    </div>
                       
                    </div>
                </div>
              
            </div>
        </div>
    </div>
@section scripts{
    <script src="~/Scripts/bootstrap-select-1.12.4/dist/js/bootstrap-select.min.js"></script>

    <script type="text/javascript">
                $(document).ready(function () {
                   document.getElementById('seLicense').style.display = 'none';

                });

               function Check() {

                   if (document.getElementById('radioRegion').checked) {
                        document.getElementById('seRegion').style.display = 'inline-block';
                        document.getElementById('seLicense').style.display = 'none';

                    }
                    else if (document.getElementById('radioLicense').checked) {
                        document.getElementById('seLicense').style.display = 'inline-block';
                        document.getElementById('seRegion').style.display = 'none';
                    }
                } 


                var region;
                $('#MultiRegion').change(function () {
                    SeRegion = $(this).val();
                    // console.log(region);

                })
                $('#MultiLicense').change(function () {
                    SeLicense = $(this).val();
                    // console.log(region);

                })

                function Search() {
                    let url;
                    let multidata;
                    if (document.getElementById('radioRegion').checked) {
                        url = '@Url.Action("SearchRegion")';
                        multidata = SeRegion;
                    }
                    else if (document.getElementById('radioLicense').checked) {
                        url = '@Url.Action("SearchLicense")';
                        multidata = SeLicense;
                    }
                    $.ajax({
                        url: url,
                        type: 'POST',
                        data: JSON.stringify(multidata),
                        contentType: 'application/json; charset=utf-8',
                        datatype: 'json',
                        success: function (data) {
                            $('#utilTbl').find('tbody tr').each(function () {
                                this.remove();
                            });
                            for (let i in data) {
                                if (data[i].COLOR == 'Green') {
                                    data[i].COLOR = '<span class="fa fa-circle " style="color:#16a085"></span>'
                                    color1 = "green"
                                    console.log(color1);
                                } else if (data[i].COLOR == 'Yellow') {
                                    data[i].COLOR = '<span class="fa fa-circle " style="color:#f1c40f"></span>'
                                    color1 = "yellow"
                                    console.log(color1);
                                } else if (data[i].COLOR == 'Red') {
                                    data[i].COLOR = '<span class="fa fa-circle " style="color:#e74c3c"></span>'
                                    color1 = "red"
                                } else {
                                    data[i].COLOR = "";
                                    color1 = "no"
                                }
                                console.log('color1' + color1);
                                console.log('data' + data[i].NO);

                                $('#utilTbl > tbody:last-child').append('<tr id="' + data[i].NO + '" class="rowfil" data-color="' + color1 + '" data-type="' + data[i].TYPE + '"><td><h6 class="margin-lr0">' + data[i].COLOR + '</h6></td><td><h6 class="margin-lr0">' + data[i].NAME + '</h6></td><td><h6 class="margin-lr0">' + data[i].TYPE + '</h6></td></tr>');
                            }
                        },
                        error: function (result) {
                            alert('Fail ');
                        }
                    });


                }//function searcch
                function myFunction() {
                    var input, filter, table, tr, td, i;
                    input = document.getElementById("txtSearch");
                    filter = input.value.toUpperCase();
                    table = document.getElementById("utilTbl");
                    tr = table.getElementsByTagName("tr");
                    for (i = 0; i < tr.length; i++) {
                        td = tr[i].getElementsByTagName("td")[1];
                        if (td) {
                            if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
                                tr[i].style.display = "";
                            } else {
                                tr[i].style.display = "none";
                            }
                        }
                    }
                }

                //////////////////////

                //$("#threshold-filter").change(function () {
                //    console.clear();
                //    var filterValue = $(this).val();
                //    var row = $('.rowfil');

                //    row.each(function (i, el) {
                //        if ($(el).attr('data-color') == filterValue) {
                //            row.hide()
                //            $(el).show();
                //        }
                //    });
                //    // In Addition to Wlin's Answer (For "All" value)
                //    if ("all" == filterValue) {
                //        row.show();
                //    }

                //});

                var
          filters = {
              color: null,
          };

                function updateFilters() {
                    $('.rowfil').hide().filter(function () {
                        var
                          self = $(this),
                          result = true; // not guilty until proven guilty

                        Object.keys(filters).forEach(function (filter) {
                            if (filters[filter] && (filters[filter] != 'all') && (filters[filter] != 'Any')) {
                                result = result && filters[filter] === self.data(filter);
                            }
                        });

                        return result;
                    }).show();
                }

                function changeFilter(filterName) {
                    filters[filterName] = this.value;
                    updateFilters();
                }

                // Threshold Dropdown Filter
                $('#threshold-filter').on('change', function () {
                    changeFilter.call(this, 'color');
                });

                // Type Dropdown Filter
                $('#type-filter').on('change', function () {
                    changeFilter.call(this, 'type');
                });



                //////////////////////

    </script>
<script>
    Chart.defaults.global.legend.labels.usePointStyle = true;
    Chart.defaults.doughnutLabels = Chart.helpers.clone(Chart.defaults.doughnut);
    var helpers = Chart.helpers;
    var defaults = Chart.defaults;
    $.ajax({
        type: "POST",
        url: "/Dashboard/AllGate",
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function (chData) {
            var aData = chData;
            var aLabels = aData[0];
            var aDatasets1 = aData[1];
            var dataT = {
                labels: aLabels,
                datasets: [{
                    label: "Test Data",
                    data: aDatasets1,
                    fill: false,
                    backgroundColor: ["#e74c3c", "#f1c40f", "#16a085", "#e67e22"],
                    hoverBackgroundColor: ["#e74c3c", "#f1c40f", "#16a085", "#e67e22"],
                    borderColor: ["#e74c3c", "#f1c40f", "#16a085", "#e67e22"],
                    borderWidth: 1
                }]
            };
            var ctx = $("#pieGate").get(0).getContext("2d");
            var myNewChart = new Chart(ctx, {
                type: 'doughnut',
                data: dataT,
                options: {
                    responsive: true,
                    pieceLabel: { mode: 'value', fontColor: 'white' },
                    title: { display: true },
                    legend: { position: 'bottom' },
                    scales: {
                        xAxes: [{ gridLines: { display: false }, display: false, scaleLabel: { display: false, labelString: '' } }],
                        yAxes: [{ gridLines: { display: false }, display: false, scaleLabel: { display: false, labelString: '' }, ticks: { stepSize: 50, beginAtZero: true } }]
                    },
                }
            });
        }
    });

    $.ajax({
        type: "POST",
        url: "/Dashboard/AllPipeline",
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function (chData) {
            var aData = chData;
            var aLabels = aData[0];
            var aDatasets1 = aData[1];
            var dataT = {
                labels: aLabels,
                datasets: [{
                    label: "Test Data",
                    data: aDatasets1,
                    fill: false,
                    backgroundColor: ["#e74c3c", "#f1c40f", "#16a085", "#e67e22"],
                    hoverBackgroundColor: ["#e74c3c", "#f1c40f", "#16a085", "#e67e22"],
                    borderColor: ["#e74c3c", "#f1c40f", "#16a085", "#e67e22"],
                    borderWidth: 1
                }]
            };
            var ctx = $("#piePipeline").get(0).getContext("2d");
            var myNewChart = new Chart(ctx, {
                type: 'doughnut',
                data: dataT,
                options: {
                    responsive: true,
                    pieceLabel: { mode: 'value', fontColor: 'white' },
                    title: { display: true },
                    legend: { position: 'bottom' },
                    scales: {
                        xAxes: [{ gridLines: { display: false }, display: false, scaleLabel: { display: false, labelString: '' } }],
                        yAxes: [{ gridLines: { display: false }, display: false, scaleLabel: { display: false, labelString: '' }, ticks: { stepSize: 50, beginAtZero: true } }]
                    },
                }
            });
        }
    });
</script> 
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
}