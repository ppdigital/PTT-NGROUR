@model PTT_NGROUR.Models.ViewModel.ModelUtilization
@{
    ViewBag.Title = "Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/Scripts/bootstrap-select-1.12.4/dist/css/bootstrap-select.min.css" rel="stylesheet" />
<div class="container-fluid">
    <br />
    <div class="ph2 ph0-xs">
        <div class=" p-3 mb-2 col-container col-container-white text-dark ">
            <div class=" " style="padding-bottom:.5rem;padding-top:1rem">

                <div class="row">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <span class=" col-lg-2 col-md-2 col-sm-1" ></span>
                        <span class="col-lg-2 col-md-2 col-sm-3 col-xs-10">
                            <label class=" ml-5 lato" style="padding-right:6px">
                                <input type="radio" name="radio" id="radioRegion" checked="checked" onclick="javascript:Check();">
                                <span class="checkmark h6 b">Region</span>
                            </label>&nbsp;
                            <label class="d-none ">
                                <input type="radio" name="radio" id="radioLicense" onclick="javascript:Check();">
                                <span class="checkmark h6 b"> License</span>
                            </label>
                        </span>
                        <div class="col-lg-4 col-md-5  col-sm-5 col-xs-7" id="seRegion" style="padding-bottom: 0rem !important">
                            <div class="form-group" style="margin-bottom:5px;">

                                <select class="selectpicker fz-12px form-control" name="MultiRegion" id="MultiRegion" multiple data-selected-text-format="count" data-live-search="true" data-actions-box="true" style="margin-bottom:-1rem;">
                                    @foreach (PTT_NGROUR.Models.DataModel.ModelRegion ml in Model.ListRegion)
                                    {
                                        <option value="@ml.REGION_ID" class="text-grey" style="word-wrap:break-word;font-size:15px" selected="selected">@ml.REGION_NAME</option>
                                    }
                                </select>
                            </div>
                        </div>


                        <div class="col-lg-4 col-md-5 col-sm-5 col-xs-7" id="seLicense" style="padding-bottom: 0rem !important">
                            <div class="form-group" style="margin-bottom:5px;">
                                <select class="selectpicker fz-12px form-control" name="MultiLicense" id="MultiLicense" multiple data-selected-text-format="count" data-live-search="true" data-actions-box="true" style="">
                                    @foreach (PTT_NGROUR.Models.DataModel.ModelLicenseMaster ml in Model.ListLicense)
                                    {
                                        <option class="hidden-sm hidden-xs" value="@ml.LICENSE_ID" style="word-wrap: break-word">@ml.LICENSE</option>
                                        <option class="hidden-lg hidden-md" value="@ml.LICENSE_ID" style="word-wrap: break-word;white-space:normal">@ml.LICENSE</option>
                                    }
                                </select>
                            </div>
                        </div>
                 
                     <!--  <div class="col-lg-2 col-md-2 col-sm-2 col-xs-5" id="seLicense" style="padding-bottom: 0rem !important">
                            <div class="form-group" style="margin-bottom:5px;">
                                <select class="selectpicker fz-12px form-control">
                                    <option value="pipeline">Pipeline</option>
                                    <option value="mustard">Gate Station</option>
                                </select>
                            </div>
                        </div>--> 
                        <span class="col-lg-1 col-sm-2 col-xs-1">
                            <button type="button" class="btn btn-primary" id="btnSearch" onclick="Search()" style="border-radius:0">
                                <span class="glyphicon glyphicon-search"></span> Search
                            </button>
                        </span>
                        <span class="col-lg-3 col-md-3 col-sm-3 col-xs-1"></span>
                    </div>
                </div>


            </div>
        </div>
    </div>
    <!--End Search-->
    <br />

    <div class="ph2 ph0-xs">
        <div style="padding-bottom:.5rem;padding-top:1rem">
            
            <div class="col-lg-12 col-md-12">
                <div class="row">
                        <div class=" p-3 mb-2 col-container col-container-white text-dark ">
                            <!--Gate Station Donut Graph -->
                            <div class="col-lg-4 col-md-6">
                               
                                <div style="font-family: Corbel; font-size: small ;text-align:center " class="row">
                                    <center>
                                        <div class="pt5">Gate Station</div>
                                        <div class="pieGraph-lg pieGraph-md pieGraph-sm pieGraph-xs" style="margin-top:-2rem;">
                                            <canvas id="pieGate" style="padding: 0;margin: auto;display: block; "> </canvas>

                                        </div>
                                    </center>
                                </div>
                            </div>
                            <!--PieLine Donut Graph -->
                            <div class="col-lg-4 col-md-6">
                                <div style="font-family: Corbel; font-size: small ;text-align:center " class="row">
                                    <center>
                                        <div class="pt5 ">Pipeline</div>
                                        <div class="pieGraph-lg pieGraph-md pieGraph-sm pieGraph-xs" style="margin-top:-2rem;">
                                            <canvas id="piePipeline" style="padding: 0;margin: auto;display: block; "> </canvas>
                                        </div>
                                    </center>
                                  </div>
                            </div>
                           
                           <!--Search Donut Graph-->
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 pt-15px pb-15px pr-0 pl-0 border-left-md border-left-lg" style="float:none">
                                <div class="form-inline">
                                    <center>
                                        <div class="input-group">
                                            <div class="input-group-btn col-lg-1 col-md-3 col-sm-3 col-xs-3 fn-xs" style="padding-left:0rem;padding-right:0rem;">

                                                <select class="form-control form-control-sm fz-12px" id="type-filter" style="height: 30px !important;">
                                                    <option id="seAll" class="fz-12px drop_role" value="all">All</option>
                                                    <option id="sePipeline" class="fz-12px drop_role" value="PIPELINE">Pipeline</option>
                                                    <option id="seGate" class="fz-12px drop_role" value="GATESTATION">Gate Station</option>

                                                </select>

                                            </div>

                                            <div class="input-group-btn col-lg-2 col-md-6 col-sm-6 col-xs-6 fn-xs" style="padding-left:0rem;padding-right:0rem;">
                                                <input id="txtSearch" class="form-control input-sm " type="text" aria-describedby="name-desc" onkeyup="myFunction()">
                                            </div>
                                            <div class="input-group-btn col-lg-1 col-md-3 col-sm-3 col-xs-3 fn-xs" style="padding-left:0rem;padding-right:0rem;">

                                                <select class="form-control form-control-sm fz-12px" id="threshold-filter" style="height: 30px !important;">
                                                    <option id="seAllThres" class="fz-12px drop_role" value="all">All Threshold</option>
                                                    <option id="seGree" class="fz-12px drop_role" value="green">Green</option>
                                                    <option id="seYello" class="fz-12px drop_role" value="yellow">Yellow</option>
                                                    <option id="seRed" class="fz-12px drop_role" value="red">Red</option>
                                                </select>

                                            </div>

                                            <!--<div class="cr"></div>-->
                                        </div>
                                    </center>
                                </div>
                                <br />
                                <div class="table-responsive scrollable-height scrollable-height-lg" id="TableValue">
                                    <table class="table table-striped table-hover" id="utilTbl">
                                        <thead>

                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            </div>
                        </div>

                   
                </div>
                </div>
                
              
            </div>
    </div>

<!--Modal View Meter -->

<div id="ModalMapDashboard" class="modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <label class="panel-title h5">View Ifame</label>
                <button type="button" class="close close_create" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>


            <div class="pv2 mv3">
                <div class="  black-80 center">
                    <iframe src="http://ptt-gis5non-p01.ptt.corp/PTT-NGROUR-GIS/page.aspx?m=dashboard" style="min-height: 430px !important; width: 100% !important;" id="map_frame"></iframe>
                </div>
                <br />
                <div class="modal-footer">

                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                </div>


            </div>
        </div>
    </div>
</div>

    @section scripts{
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js" type="text/javascript"></script>
        <script src="~/Scripts/Chart/Chart.PieceLabel.min.js"></script>
        <script src="~/Scripts/bootstrap-select-1.12.4/dist/js/bootstrap-select.min.js"></script>
        <script src="~/Scripts/bootstrap.min.js"></script>
        @Html.Partial("PartialIndexScript")

        <script type="text/javascript">
            var SeRegion;
            var SeLicense;
            $(document).ready(function () {
                document.getElementById('seLicense').style.display = 'none';
                //$('#MultiRegion').selectpicker('selectAll').selectpicker('refresh');
            });

            function Check() {

                if (document.getElementById('radioRegion').checked) {
                    document.getElementById('seRegion').style.display = 'inline-block';
                    document.getElementById('seLicense').style.display = 'none';

                }
                else if (document.getElementById('radioLicense').checked) {
                    document.getElementById('seLicense').style.display = 'inline-block';
                    document.getElementById('seRegion').style.display = 'none';
                }
            }


            var region;
            $('#MultiRegion').change(function () {
                SeRegion = $(this).val();
                // console.log(region);

            })
            $('#MultiLicense').change(function () {
                SeLicense = $(this).val();
                // console.log(region);

            })

            function Search2() {
                
                let url;
                let graphurl;
                let multidata;
                if (document.getElementById('radioRegion').checked) {
                    url = '@Url.Action("SearchRegion")';
                    graphurl = '@Url.Action("SearchGraphRegion")';
                    multidata = SeRegion;
                }
                else if (document.getElementById('radioLicense').checked) {
                    url = '@Url.Action("SearchLicense")';
                    graphurl = '@Url.Action("SearchGraphLicense")';
                    multidata = SeLicense;
                }
                $.ajax({
                    url: url,
                    type: 'POST',
                    data: JSON.stringify(multidata),
                    contentType: 'application/json; charset=utf-8',
                    datatype: 'json',
                    success: function (data) {
                        $('#utilTbl').find('tbody tr').each(function () {
                            this.remove();
                        });
                        for (let i in data) {
                            if (data[i].THRESHOLD == 'Pass') {
                                THRESHOLD = '<span class="fa fa-circle " style="color:#16a085"></span>'
                                color1 = "green"
                            } else if (data[i].THRESHOLD == 'Warning') {
                                THRESHOLD = '<span class="fa fa-circle " style="color:#f1c40f"></span>'
                                color1 = "yellow"
                            } else if (data[i].THRESHOLD == 'Alert') {
                                THRESHOLD = '<span class="fa fa-circle " style="color:#e74c3c"></span>'
                                color1 = "red"
                            } else if (data[i].FLAG == '1') {
                                THRESHOLD = '<span class="fa fa-flag " style="color:#e67e22"></span>'
                                color1 = "flag"
                            } else {
                                THRESHOLD = "";
                                color1 = "no"
                            }
                            if (data[i].STATUS == 'INACTIVE' && data[i].TYPE == 'METERING') {
                                status = 'style="color:red"';
                            } else {
                                status = "";
                            }

                            if (data[i].TYPE == 'METERING') {

                                if (data[i].ID == "") {
                                    name = "" + data[i].NAME;
                                    value = data[i].OBJ_TYPE;
                                } else {
                                    name = "" + data[i].NAME + " (" + data[i].ID + ")";
                                    value = data[i].OBJ_TYPE;
                                }

                            } else {
                                name = data[i].NAME;
                                if (data[i].TYPE == 'PIPELINE') {
                                    value = data[i].VALUE + " ft/s";
                                } else if (data[i].TYPE == 'GATESTATION') {
                                    value = data[i].VALUE + " %";
                                }

                            }

                            $('#utilTbl > tbody:last-child').append('<tr id="' + data[i].NO + '" class="rowfil pointer" data-color="' + color1 + '" data-type="' + data[i].TYPE + '" ' + status + '><td><h6 class="margin-lr0">' + THRESHOLD + '</h6></td><td><h6 class="margin-lr0">' + name + '</h6></td><td><h6 class="margin-lr0">' + value + '</h6></td><td><h6 class="margin-lr0">' + data[i].TYPE + '</h6></td></tr>');

                        }
                    },
                    error: function (result) {
                        alert('Please select the data');
                    }
                });

                Chart.defaults.global.legend.labels.usePointStyle = true;
                Chart.defaults.doughnutLabels = Chart.helpers.clone(Chart.defaults.doughnut);
                var helpers = Chart.helpers;
                var defaults = Chart.defaults;
                $.ajax({
                    type: "POST",
                    url: graphurl,
                    data: JSON.stringify(multidata),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (chData) {
                        var aData = chData;
                        var aLabels = aData[0];
                        var aDatasets1 = aData[1];
                        var dataT = {
                            labels: aLabels,
                            datasets: [{
                                label: "Test Data",
                                data: aDatasets1,
                                fill: false,
                                backgroundColor: ["#e74c3c", "#f1c40f", "#16a085", "#e67e22"],
                                hoverBackgroundColor: ["#e74c3c", "#f1c40f", "#16a085", "#e67e22"],
                                borderColor: ["#e74c3c", "#f1c40f", "#16a085", "#e67e22"],
                                borderWidth: 1
                            }]
                        }; 
                        var ctx = $("#pieGate").get(0).getContext("2d");
                        var myNewChart = new Chart(ctx, {
                            type: 'doughnut',
                            data: dataT,
                            options: {
                                responsive: true,
                                pieceLabel: { mode: 'value', fontColor: 'white' },
                                title: { display: true },
                                legend: { position: 'bottom' },
                                scales: {
                                    xAxes: [{ gridLines: { display: false }, display: false, scaleLabel: { display: false, labelString: '' } }],
                                    yAxes: [{ gridLines: { display: false }, display: false, scaleLabel: { display: false, labelString: '' }, ticks: { stepSize: 50, beginAtZero: true } }]
                                },
                            }
                        });
                    }
                });

                $.ajax({
                    type: "POST",
                    url: graphurl,
                    data: JSON.stringify(multidata),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (chData) {
                        var aData = chData;
                        var aLabels = aData[0];
                        var aDatasets1 = aData[1];
                        var dataT = {
                            labels: aLabels,
                            datasets: [{
                                label: "Test Data",
                                data: aDatasets1,
                                fill: false,
                                backgroundColor: ["#e74c3c", "#f1c40f", "#16a085", "#e67e22"],
                                hoverBackgroundColor: ["#e74c3c", "#f1c40f", "#16a085", "#e67e22"],
                                borderColor: ["#e74c3c", "#f1c40f", "#16a085", "#e67e22"],
                                borderWidth: 1
                            }]
                        };
                        var ctx = $("#piePipeline").get(0).getContext("2d");
                        var myNewChart = new Chart(ctx, {
                            type: 'doughnut',
                            data: dataT,
                            options: {
                                responsive: true,
                                pieceLabel: { mode: 'value', fontColor: 'white' },
                                title: { display: true },
                                legend: { position: 'bottom' },
                                scales: {
                                    xAxes: [{ gridLines: { display: false }, display: false, scaleLabel: { display: false, labelString: '' } }],
                                    yAxes: [{ gridLines: { display: false }, display: false, scaleLabel: { display: false, labelString: '' }, ticks: { stepSize: 50, beginAtZero: true } }]
                                },
                            }
                        });
                    }
                });


            }
            //function searcch
            function myFunction() {
                var input, filter, table, tr, td, i;
                input = document.getElementById("txtSearch");
                filter = input.value.toUpperCase();
                table = document.getElementById("utilTbl");
                tr = table.getElementsByTagName("tr");
                for (i = 0; i < tr.length; i++) {
                    td = tr[i].getElementsByTagName("td")[1];
                    if (td) {
                        if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
                            tr[i].style.display = "";
                        } else {
                            tr[i].style.display = "none";
                        }
                    }
                }
            }

            //////////////////////

            //$("#threshold-filter").change(function () {
            //    console.clear();
            //    var filterValue = $(this).val();
            //    var row = $('.rowfil');

            //    row.each(function (i, el) {
            //        if ($(el).attr('data-color') == filterValue) {
            //            row.hide()
            //            $(el).show();
            //        }
            //    });
            //    // In Addition to Wlin's Answer (For "All" value)
            //    if ("all" == filterValue) {
            //        row.show();
            //    }

            //});

            var
      filters = {
          color: null,
      };

            function updateFilters() {
                $('.rowfil').hide().filter(function () {
                    var
                      self = $(this),
                      result = true; // not guilty until proven guilty

                    Object.keys(filters).forEach(function (filter) {
                        if (filters[filter] && (filters[filter] != 'all') && (filters[filter] != 'Any')) {
                            result = result && filters[filter] === self.data(filter);
                        }
                    });

                    return result;
                }).show();
            }

            function changeFilter(filterName) {
                filters[filterName] = this.value;
                updateFilters();
            }

            // Threshold Dropdown Filter
            $('#threshold-filter').on('change', function () {
                changeFilter.call(this, 'color');
            });

            // Type Dropdown Filter
            $('#type-filter').on('change', function () {
                changeFilter.call(this, 'type');
            });



            //////////////////////

        </script>
        <script>
            Chart.defaults.global.legend.labels.usePointStyle = true;
            Chart.defaults.doughnutLabels = Chart.helpers.clone(Chart.defaults.doughnut);
            var helpers = Chart.helpers;
            var defaults = Chart.defaults;
            //$.ajax({
            //    type: "POST",
            //    url: "/Dashboard/AllGate",
            //    contentType: "application/json; charset=utf-8",
            //    dataType: "json",
            //    success: function (chData) {
            //        console.log(chData);
            //        var aData = chData;
            //        var aLabels = aData[0];
            //        var aDatasets1 = aData[1];
            //        var dataT = {
            //            labels: aLabels,
            //            datasets: [{
            //                label: "Test Data",
            //                data: aDatasets1,
            //                fill: false,
            //                backgroundColor: ["#e74c3c", "#f1c40f", "#16a085", "#e67e22"],
            //                hoverBackgroundColor: ["#e74c3c", "#f1c40f", "#16a085", "#e67e22"],
            //                borderColor: ["#e74c3c", "#f1c40f", "#16a085", "#e67e22"],
            //                borderWidth: 1
            //            }]
            //        }; 
            //        var ctx = $("#pieGate").get(0).getContext("2d");
            //        var myNewChart = new Chart(ctx, {
            //            type: 'doughnut',
            //            data: dataT,
            //            options: {
            //                responsive: true,
            //                pieceLabel: { mode: 'value', fontColor: 'white' },
            //                title: { display: true },
            //                legend: { position: 'bottom' },
            //                scales: {
            //                    xAxes: [{ gridLines: { display: false }, display: false, scaleLabel: { display: false, labelString: '' } }],
            //                    yAxes: [{ gridLines: { display: false }, display: false, scaleLabel: { display: false, labelString: '' }, ticks: { stepSize: 50, beginAtZero: true } }]
            //                },
            //            }
            //        });
            //    }
            //});

            //$.ajax({
            //    type: "POST",
            //    url: "/Dashboard/AllPipeline",
            //    contentType: "application/json; charset=utf-8",
            //    dataType: "json",
            //    success: function (chData) {
            //        var aData = chData;
            //        var aLabels = aData[0];
            //        var aDatasets1 = aData[1];
            //        var dataT = {
            //            labels: aLabels,
            //            datasets: [{
            //                label: "Test Data",
            //                data: aDatasets1,
            //                fill: false,
            //                backgroundColor: ["#e74c3c", "#f1c40f", "#16a085", "#e67e22"],
            //                hoverBackgroundColor: ["#e74c3c", "#f1c40f", "#16a085", "#e67e22"],
            //                borderColor: ["#e74c3c", "#f1c40f", "#16a085", "#e67e22"],
            //                borderWidth: 1
            //            }]
            //        };
            //        var ctx = $("#piePipeline").get(0).getContext("2d");
            //        var myNewChart = new Chart(ctx, {
            //            type: 'doughnut',
            //            data: dataT,
            //            options: {
            //                responsive: true,
            //                pieceLabel: { mode: 'value', fontColor: 'white' },
            //                title: { display: true },
            //                legend: { position: 'bottom' },
            //                scales: {
            //                    xAxes: [{ gridLines: { display: false }, display: false, scaleLabel: { display: false, labelString: '' } }],
            //                    yAxes: [{ gridLines: { display: false }, display: false, scaleLabel: { display: false, labelString: '' }, ticks: { stepSize: 50, beginAtZero: true } }]
            //                },
            //            }
            //        });
            //    }
            //});

            //////////////////////////////////////
            /*
            $.ajax({
                url: "/Dashboard/SearchRegionAll",
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                datatype: 'json',
                success: function (data) {
                    $('#utilTbl').find('tbody tr').each(function () {
                        this.remove();
                    });
                    for (let i in data) {
                        if (data[i].THRESHOLD == 'Pass') {
                            THRESHOLD = '<span class="fa fa-circle " style="color:#16a085"></span>'
                            color1 = "green"
                        } else if (data[i].THRESHOLD == 'Warning') {
                            THRESHOLD = '<span class="fa fa-circle " style="color:#f1c40f"></span>'
                            color1 = "yellow"
                        } else if (data[i].THRESHOLD == 'Alert') {
                            THRESHOLD = '<span class="fa fa-circle " style="color:#e74c3c"></span>'
                            color1 = "red"
                        } else if (data[i].FLAG == '1') {
                            THRESHOLD = '<span class="fa fa-flag " style="color:#e67e22"></span>'
                            color1 = "flag"
                        } else {
                            THRESHOLD = "";
                            color1 = "no"
                        }
                        if (data[i].STATUS == 'INACTIVE' && data[i].TYPE == 'METERING') {
                            status = 'style="color:red"';
                        } else {
                            status = "";
                        }

                        if (data[i].TYPE == 'METERING') {

                            if (data[i].ID == "") {
                                name = "" + data[i].NAME;
                                value = data[i].OBJ_TYPE;
                            } else {
                                name = "" + data[i].NAME + " (" + data[i].ID + ")";
                                value = data[i].OBJ_TYPE;
                            }

                        } else {
                            name = data[i].NAME;
                            if (data[i].TYPE == 'PIPELINE') {
                                value = data[i].VALUE + " ft/s";
                            } else if (data[i].TYPE == 'GATESTATION') {
                                value = data[i].VALUE + " %";
                            }

                        }

                        $('#utilTbl > tbody:last-child').append('<tr id="' + data[i].NO + '" class="rowfil pointer" data-color="' + color1 + '" data-type="' + data[i].TYPE + '" ' + status + '><td><h6 class="margin-lr0">' + THRESHOLD + '</h6></td><td><h6 class="margin-lr0">' + name + '</h6></td><td><h6 class="margin-lr0">' + value + '</h6></td><td><h6 class="margin-lr0">' + data[i].TYPE + '</h6></td></tr>');

                    }
                },
                error: function (result) {
                    alert('Please select the data');
                }
            });*/
        </script>
        @*<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>*@
    }
